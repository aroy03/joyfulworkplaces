
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Convert CSV To JSON </title>
	
	<script src="papaparse.js"></script>
	<script src="papaparse.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
	
  </head>

  <body>

<script>
  var information;
  
        function reOrder(csvDataInObjects) {
        var i;
        
        for(i=0; i<10; i++){
        console.log(csvDataInObjects[i]);
        }
          var newObj = [];		  		  	  
		  var level0Children = [];		 
		  var counter = csvDataInObjects.length-1;
		 
		  while(counter >= 0){
		    console.log("I am in with counter --->"+counter);
 			if(csvDataInObjects[counter].children == ""){
			  
			}
		   
			if(csvDataInObjects[counter].children != ""){
			
			    var newChildObject = {};
		        var splitChildID = [];
		        var splitChildObjectArray = [];
				var childID = csvDataInObjects[counter].children;
			    console.log("childID--->"+childID);
			    
			    
			    splitChildID = childID.toString().split(",").map(Number);
			    console.log(splitChildID.length);
				
				//If childID does NOT contain comma
				
				if(splitChildID.length <= 1){
				   newChildObject = csvDataInObjects[childID-1];				
				   csvDataInObjects[counter].children = newChildObject;
				   console.log(csvDataInObjects[counter]);
			    }
			    //If childID contains comma
			    if(splitChildID.length > 1){
			    
			       var c = 0;
			       for(c=0;c< splitChildID.length;c++){
			            console.log("splitChildID[c]----->"+splitChildID[c]);
						splitChildObjectArray[c] = csvDataInObjects[splitChildID[c]-1];
						
						if (c == splitChildID.length - 1){			
						   csvDataInObjects[counter].children = splitChildObjectArray;
						}
						
				   }
			    }
			    
			}
		   
			counter--;
		  }		      
		  return csvDataInObjects;
		  // newObj = {name:csvDataInObjects[counter].name, parent:csvDataInObjects[counter].parent, children:level0Children};
// 		  console.log(newObj);		  
		 
		 }
		 
   var data1 = [];
   var count = 0;	
   var preppedData = {};   
 
  function handleFileSelect(evt) {
    var file = evt.target.files[0];
 
    Papa.parse(file, {
      header: true,
      dynamicTyping: true,
      complete: function(results) {
        information = results;
        console.log(information);
        console.log("information.data.length---->"+information.data.length);
        
        while(count<information.data.length){
			data1[count] = information.data[count];
            console.log(data1[count]);
			count++;
        }
        
        console.log("count--->"+count);
        console.log(data1);
        preppedData = reOrder(data1);
        
        console.log(preppedData[0]);
        
      }
    });
  }
 
  $(document).ready(function(){
    $("#csv-file").change(handleFileSelect);
  });
  

</script>

<input type="file" id="csv-file" name="files"/>
	
  </body>
</html>